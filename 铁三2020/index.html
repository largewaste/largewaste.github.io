<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.66">
<title data-react-helmet="true">铁三2020 取证 | largewaste&#x27;s blog</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_language" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="铁三2020 取证 | largewaste&#x27;s blog"><meta data-react-helmet="true" name="description" content="misc"><meta data-react-helmet="true" property="og:description" content="misc"><meta data-react-helmet="true" property="og:url" content="https://your-docusaurus-test-site.com/铁三2020"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://your-docusaurus-test-site.com/铁三2020"><link rel="stylesheet" href="/styles.d125ba5e.css">
<link rel="preload" href="/styles.0c2d5258.js" as="script">
<link rel="preload" href="/runtime~main.80b03b24.js" as="script">
<link rel="preload" href="/main.0ea667b1.js" as="script">
<link rel="preload" href="/1.3dacca60.js" as="script">
<link rel="preload" href="/2.a622a438.js" as="script">
<link rel="preload" href="/35.bad83159.js" as="script">
<link rel="preload" href="/36.d655c893.js" as="script">
<link rel="preload" href="/935f2afb.f554c8f8.js" as="script">
<link rel="preload" href="/17896441.e83fb1cc.js" as="script">
<link rel="preload" href="/5b960f4a.f540a943.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">largewaste</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/">Docs</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">largewaste</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/">Docs</a></li><li class="menu__list-item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Welcome</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/">helloWorld</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Note</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/hexo">hexo的折腾记录</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/build_phpstorm">phpstorm配置</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Write-up</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!" tabindex="0">2020</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/铁三2020">铁三2020</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/hxb2020">hxb2020</a></li></ul></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">铁三2020 取证</h1></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="misc"></a>misc<a aria-hidden="true" tabindex="-1" class="hash-link" href="#misc" title="Direct link to heading">#</a></h2><p><img src="https://imgs-1258898244.cos.ap-chengdu.myqcloud.com/ctf/%E9%93%81%E4%B8%892020/00.png" alt="all"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="stage-1"></a>stage 1<a aria-hidden="true" tabindex="-1" class="hash-link" href="#stage-1" title="Direct link to heading">#</a></h3><p>找三个ip</p><p>找三个ip，直接cd进 <code>/var/log</code> 下，看 <code>./httpd/</code> 目录下的日志，</p><p><img src="https://imgs-1258898244.cos.ap-chengdu.myqcloud.com/ctf/%E9%93%81%E4%B8%892020/01.png" alt="img01"></p><p><strong>access_log_20201030</strong>可以看到一些请求日志，<strong>modsec_audit</strong> 可以看到所有详细的post报文</p><p>其中 <code>192.168.12.144</code> 这个ip执行了zzzcms的安装，设置密码之类的操作，并没有别的操作，所以不是攻击ip</p><p><code>192.168.12.103</code> 这个为主站的ip</p><p><code>192.168.31.58</code> 在日志中执行了大量的操作，包括扫目录、登录等，所以可以判定为攻击ip</p><p>在做题过程中，系统会提示收到新邮件，查看新邮件可以看到一个外网ip通过<code>/dev/tcp</code>弹了shell，所以可以判定为攻击ip，用<code>ps -ef</code>也可以看到</p><p><img src="https://imgs-1258898244.cos.ap-chengdu.myqcloud.com/ctf/%E9%93%81%E4%B8%892020/02.png" alt="img02"></p><p><code>23.83.247.111</code></p><p>最后一个ip的日志在<code>/var/log/audit</code>下面，可以看到<code>192.168.12.145</code>这个ip做了一些莫名其妙的操作，因为没别的可以选了，所以可以判定为攻击ip</p><p><img src="https://imgs-1258898244.cos.ap-chengdu.myqcloud.com/ctf/%E9%93%81%E4%B8%892020/03.png" alt="img03"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="stage-2"></a>stage 2<a aria-hidden="true" tabindex="-1" class="hash-link" href="#stage-2" title="Direct link to heading">#</a></h3><p>ssh登录日志也在httpd目录下，通过vim把28分到34分的所有登录日志截取出来，然后检索<strong>Failed</strong>字符出现的次数，就是登录失败的次数</p><p>vim的指令为 <code>:%s/Failed//gn</code></p><p><img src="https://imgs-1258898244.cos.ap-chengdu.myqcloud.com/ctf/%E9%93%81%E4%B8%892020/04.png" alt="img04"></p><p>次数为582</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="stage3"></a>stage3<a aria-hidden="true" tabindex="-1" class="hash-link" href="#stage3" title="Direct link to heading">#</a></h3><p>之前看日志的时候发现了一堆<code>HEAD</code>请求，估计是用dirsearch之类的扫描的，所以只需要检索HEAD关键字出现的次数就可以了</p><p><img src="https://imgs-1258898244.cos.ap-chengdu.myqcloud.com/ctf/%E9%93%81%E4%B8%892020/05.png" alt="img05"></p><p>结果为263386次</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="stage-4"></a>stage 4<a aria-hidden="true" tabindex="-1" class="hash-link" href="#stage-4" title="Direct link to heading">#</a></h3><p>post的详细请求报文在<strong>modsec_audit</strong>中，查看报文，发现<code>adminpass=</code>这个参数是登录admin用的，检索<strong>&amp;adminpass=</strong>这个字符串，发现出现8次，而且只有最后一次出现了302跳转，所以可以判定为最后一次登陆成功</p><p><img src="https://imgs-1258898244.cos.ap-chengdu.myqcloud.com/ctf/%E9%93%81%E4%B8%892020/06.png" alt="img06"></p><p>所以验证码为ngas</p></div></article><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/build_phpstorm"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« phpstorm配置</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/hxb2020"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">hxb2020 wp »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#misc" class="table-of-contents__link">misc</a><ul><li><a href="#stage-1" class="table-of-contents__link">stage 1</a></li><li><a href="#stage-2" class="table-of-contents__link">stage 2</a></li><li><a href="#stage3" class="table-of-contents__link">stage3</a></li><li><a href="#stage-4" class="table-of-contents__link">stage 4</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Friends-link</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">welcome</a></li><li class="footer__item"><a class="footer__link-item" href="/">Write-up</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2020 largewaste, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.0c2d5258.js"></script>
<script src="/runtime~main.80b03b24.js"></script>
<script src="/main.0ea667b1.js"></script>
<script src="/1.3dacca60.js"></script>
<script src="/2.a622a438.js"></script>
<script src="/35.bad83159.js"></script>
<script src="/36.d655c893.js"></script>
<script src="/935f2afb.f554c8f8.js"></script>
<script src="/17896441.e83fb1cc.js"></script>
<script src="/5b960f4a.f540a943.js"></script>
</body>
</html>